# Valeurs par défaut pour le chart Helm générique online-boutique-service
# Ce fichier définit les valeurs par défaut pour TOUS les services.
# Chaque service surcharge ces valeurs via son propre fichier dans helm-values/dev/ ou helm-values/prod/

# ============================================================================
# IDENTIFICATION DU SERVICE
# ============================================================================
# Nom du service (OBLIGATOIRE) - sera surchargé par les fichiers values spécifiques
name: ""

# ============================================================================
# CONFIGURATION DE L'IMAGE DOCKER
# ============================================================================
image:
  # Repository par défaut (Google Cloud Registry)
  repository: us-central1-docker.pkg.dev/google-samples/microservices-demo
  tag: latest  # Tag par défaut, surchargé en dev/prod avec v0.10.1
  pullPolicy: IfNotPresent

# ============================================================================
# RÉPLICATION
# ============================================================================
# Nombre de réplicas par défaut
# DEV: généralement 1 pour économiser les ressources
# PROD: 2-3 pour haute disponibilité
replicaCount: 1

# ============================================================================
# SERVICE KUBERNETES
# ============================================================================
service:
  type: ClusterIP  # Type par défaut (interne au cluster)
  port: 8080       # Port du service (sera surchargé par chaque microservice)
  targetPort: 8080 # Port du container (doit correspondre au PORT de l'app)
  # Pour exposer en dehors du cluster, utiliser NodePort ou LoadBalancer
  nodePort: null

# ============================================================================
# RESSOURCES CPU/MÉMOIRE
# ============================================================================
# Limites et requêtes de ressources
# Important: les requests garantissent les ressources, les limits les plafonnent
resources:
  limits:
    cpu: 200m      # Maximum CPU (200 millicores = 0.2 CPU)
    memory: 128Mi  # Maximum mémoire
  requests:
    cpu: 100m      # CPU garanti
    memory: 64Mi   # Mémoire garantie

# ============================================================================
# PROBES DE SANTÉ (HEALTH CHECKS)
# ============================================================================
# Liveness: vérifie que le container est vivant (redémarre si échec)
livenessProbe:
  enabled: true
  httpGet:           # Par défaut HTTP, peut être gRPC selon le service
    path: /healthz
    port: 8080
  initialDelaySeconds: 10  # Attendre 10s avant le 1er check
  periodSeconds: 10        # Vérifier toutes les 10s
  timeoutSeconds: 1
  failureThreshold: 3      # Redémarrer après 3 échecs

# Readiness: vérifie que le service est prêt à recevoir du trafic
readinessProbe:
  enabled: true
  httpGet:
    path: /healthz
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 1
  failureThreshold: 3

# ============================================================================
# VARIABLES D'ENVIRONNEMENT
# ============================================================================
# Configurées spécifiquement par chaque service
env: []
  # Exemple:
  # - name: PORT
  #   value: "8080"
  # - name: DISABLE_PROFILER
  #   value: "1"  # Désactive Google Cloud Profiler (nécessite GCP)

# ============================================================================
# AUTOSCALING (HPA - Horizontal Pod Autoscaler)
# ============================================================================
# Augmente/diminue automatiquement le nombre de pods selon la charge
autoscaling:
  enabled: false  # Désactivé par défaut, activé en PROD pour services critiques
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 75    # Scale up si CPU > 75%
  targetMemoryUtilizationPercentage: 80 # Scale up si RAM > 80%

# ============================================================================
# PDB (Pod Disruption Budget)
# ============================================================================
# Garantit un minimum de pods disponibles pendant les maintenances
podDisruptionBudget:
  enabled: false     # Désactivé par défaut, activé en PROD
  minAvailable: 1    # Au moins 1 pod doit rester disponible

# ============================================================================
# LABELS ET ANNOTATIONS
# ============================================================================
labels: {}
  # Exemple: app.kubernetes.io/part-of: online-boutique

annotations: {}

# ============================================================================
# CONFIGMAP ET SECRETS
# ============================================================================
# ConfigMap pour données de configuration non sensibles
configMap: {}
  # KEY: value

# Secret pour données sensibles (credentials, tokens, etc.)
secret: {}
  # SECRET_KEY: secret_value

# ============================================================================
# RBAC (Role-Based Access Control)
# ============================================================================
# ServiceAccount: identité du pod dans le cluster
serviceAccount: false  # Désactivé par défaut

# Règles RBAC: définir les permissions du ServiceAccount
rbac:
  enabled: false
  rules: []
    # Exemple:
    # - apiGroups: [""]
    #   resources: ["pods"]
    #   verbs: ["get", "list"]

# ============================================================================
# INGRESS (Exposition HTTP/HTTPS)
# ============================================================================
# Permet d'exposer le service via HTTP/HTTPS avec nom de domaine
ingress:
  enabled: false  # Désactivé par défaut, activé uniquement pour frontend
  className: "nginx"  # Utilise NGINX Ingress Controller
  annotations: {}
    # Exemples d'annotations courantes:
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: Prefix
  tls: []  # Configuration TLS/SSL (HTTPS)
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local

# ============================================================================
# NETWORKPOLICY (Sécurité réseau)
# ============================================================================
# Contrôle les communications réseau entre pods (firewall interne)
networkPolicy:
  enabled: false  # Désactivé par défaut pour éviter les problèmes
  policyTypes:
    - Ingress  # Trafic entrant
    - Egress   # Trafic sortant
  ingress: []
    # Exemple: autoriser uniquement le frontend
    # - from:
    #   - podSelector:
    #       matchLabels:
    #         app: frontend
    #   ports:
    #   - protocol: TCP
    #     port: 8080
  egress: []
    # Exemple: autoriser vers un backend spécifique
    # - to:
    #   - podSelector:
    #       matchLabels:
    #         app: backend
    #   ports:
    #   - protocol: TCP
    #     port: 8080

# ============================================================================
# SECURITYCONTEXT (Sécurité des containers)
# ============================================================================
# Configure les contraintes de sécurité au niveau pod et container
securityContext:
  enabled: false  # Désactivé par défaut, à activer en production
  runAsNonRoot: true           # Force l'exécution avec un user non-root
  runAsUser: 1000              # UID de l'utilisateur
  runAsGroup: 1000             # GID du groupe
  fsGroup: 1000                # Groupe propriétaire des volumes
  allowPrivilegeEscalation: false  # Empêche l'escalade de privilèges
  readOnlyRootFilesystem: false    # Filesystem en lecture seule (breaking pour certaines apps)
  capabilities:
    drop:
      - ALL  # Supprime toutes les capabilities Linux (principe du moindre privilège)
